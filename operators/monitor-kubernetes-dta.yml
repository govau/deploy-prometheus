# Must be applied after the standard operators/monitor-kubernetes.yml

- type: replace
  path: /instance_groups/name=prometheus2/jobs/name=kube_state_metrics_exporter/properties/kube_state_metrics_exporter/kubeconfig_tls_ca?
  value: ((kubernetes_apiserver_ca))

- type: replace
  path: /instance_groups/name=prometheus2/jobs/name=prometheus2/properties/prometheus/scrape_configs/job_name=kubernetes_nodes/tls_config?
  value:
    ca_file: /var/vcap/jobs/kube_state_metrics_exporter/config/kubeca.pem

- type: replace
  path: /instance_groups/name=prometheus2/jobs/name=prometheus2/properties/prometheus/scrape_configs/job_name=kubernetes_nodes/kubernetes_sd_configs/role=node/tls_config?
  value:
    ca_file: /var/vcap/jobs/kube_state_metrics_exporter/config/kubeca.pem

- type: replace
  path: /instance_groups/name=prometheus2/jobs/name=prometheus2/properties/prometheus/scrape_configs/job_name=kubernetes_apiservers/tls_config?
  value:
    ca_file: /var/vcap/jobs/kube_state_metrics_exporter/config/kubeca.pem

- type: replace
  path: /instance_groups/name=prometheus2/jobs/name=prometheus2/properties/prometheus/scrape_configs/job_name=kubernetes_apiservers/kubernetes_sd_configs/role=endpoints/tls_config?
  value:
    ca_file: /var/vcap/jobs/kube_state_metrics_exporter/config/kubeca.pem
