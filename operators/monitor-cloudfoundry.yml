
# Prometheus Alerts
- type: replace
  path: /instance_groups/name=prometheus2/jobs/name=cloudfoundry_alerts?/release
  value: prometheus

- type: replace
  path: /instance_groups/name=prometheus2/jobs/name=prometheus2/properties/prometheus/rule_files/-
  value: /var/vcap/jobs/cloudfoundry_alerts/*.alerts.yml

# Grafana Dashboards
- type: replace
  path: /instance_groups/name=grafana/jobs/name=cloudfoundry_dashboards?/release
  value: prometheus

- type: replace
  path: /instance_groups/name=grafana/jobs/name=grafana/properties/grafana/prometheus/dashboard_folders/name=Cloudfoundry?/files/-
  value: /var/vcap/jobs/cloudfoundry_dashboards/cf*.json

- type: replace
  path: /instance_groups/name=grafana/jobs/name=grafana/properties/grafana/prometheus/dashboard_folders/name=Prometheus?/files/-
  value: /var/vcap/jobs/cloudfoundry_dashboards/prometheus*.json

# Monitor logging stuff. TODO move this:
- type: replace
  path: /instance_groups/name=prometheus2/jobs/name=prometheus2/properties/prometheus/scrape_configs/-
  value:
    job_name: kinesis
    metrics_path: /metrics
    scheme: https
    static_configs:
    - targets:
      - kinesis-a.system.d.cld.gov.au
      - kinesis-b.system.d.cld.gov.au
      - kinesis-a.system.y.cld.gov.au
      - kinesis-b.system.y.cld.gov.au
      - kinesis-a.system.b.cld.gov.au
      - kinesis-b.system.b.cld.gov.au

# Override alert threshold
# This threshold is related to the size of the diego-cell ephemeral disk and the
# cf-deployment's garden-release grootfs.reserved_space_for_other_jobs_in_mb property.
# At time of writing in cga reserved_space_for_other_jobs_in_mb default 15GB,
# and available ephemeral disk space is 68GB, which is approx 22%. Therefore we
# set the threshold to slightly less i.e. 20%
- type: replace
  path: /instance_groups/name=prometheus2/jobs/name=cloudfoundry_alerts/properties?/cloudfoundry_alerts/overall_available_disk/threshold
  value: 20
